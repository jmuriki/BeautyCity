<!DOCTYPE html>
{% extends 'base.html' %}
{% load static %}

{% block links %}

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css" integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- 	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css.map">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css.map"> -->
	<link rel="stylesheet" href="{% static 'css/bootstrap-grid.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/air-datepicker.css' %}">
	<script src="{% static 'js/air-datepicker.js' %}"></script>
	<link rel="stylesheet" href="{% static 'css/main.css' %}">

{% endblock %}

{% block body %}

<body class="servicePage">

{% endblock %}

{% block content %}

	<section id="service">
		<div class="container">
			<div class="service">
				<div class="breadCrumbs">
					<a href="{% url 'main_page' %}" class="breadCrumbs__item">На главную</a>
				</div>
				<div class="service__block">
					<h1 class="service__title">Запись на услугу</h1>
					<button class="service__btn btn">Запись по телефону</button>
				</div>
				
				<form class="service__form">
					<div class="service__form_block service__salons">
						<button class="accordion">(Выберите салон)</button>
						<div class="panel">

							{% if salons %}

								{% for salon in salons %}

									<div class="accordion__block fic">
										<div class="accordion__block_intro">{{ salon.name }}</div>
										<div class="accordion__block_address">{{ salon.address }}</div>
									</div>

								{% endfor %}

							{% endif %}

						</div>
					</div>
					<div class="service__form_block service__services">
						<button class="accordion">(Выберите услугу)</button>
						<div class="panel">

							{% if categories %}

								{% for category in categories %}

									<button class="accordion">{{ category }}</button>
									<div class="panel">

										{% for service in category.services.all %}

											<div class="accordion__block_items">
												<div class="accordion__block_item fic">
													<div class="accordion__block_item_intro">{{ service.name }}</div>
													<div class="accordion__block_item_address">{{ service.price }} ₽</div>
												</div>
											</div>

										{% endfor %}

									</div>

								{% endfor %}

							{% endif %}

						</div>
					</div>
					<div class="service__form_block service__masters">
						<button class="accordion">(Выберите мастера)</button>
						<div class="panel">

							{% if masters %}

								{% for master in masters %}

									<div class="accordion__block fic">
										<div class="accordion__block_elems fic">
											{% if master.foto %}
												<img src="{% static master.foto.url %}" alt="avatar" class="accordion__block_img">
											{% endif %}
											<div class="accordion__block_master">{{ master.name }}</div>
										</div>
										<div class="accordion__block_prof">{{ master.specialization }}</div>
									</div>

								{% endfor %}

							{% endif %}

						</div>
					</div>
				</form>
			</div>
		</div>
	</section>

	<section id="time">
		<div class="container">
			<div class="time">
				<h2 class="time__title">Выберите время</h2>
				<div class="time__block">
					<div class="row">
						<div class="col-md-4">
							<div id="datepickerHere"></div>
						</div>
						<div class="col-md-8">
							<div class="time__elems">
								<div class="time__items">
									<div class="time__elems_intro">Утро</div>
									<div class="time__elems_elem fic">
										<button data-time="10:00" class="time__elems_btn" name="selected_time">10:00</button>
									</div>
								</div>
								<div class="time__items">
									<div class="time__elems_intro">День</div>
									<div class="time__elems_elem fic">
										<button data-time="12:00" class="time__elems_btn" name="selected_time">12:00</button>
									</div>
								</div>
								<div class="time__items">
									<div class="time__elems_intro">Вечер</div>
									<div class="time__elems_elem fic">
										<button data-time="17:00" class="time__elems_btn" name="selected_time">17:00</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="time__btns">
					<div class="row">
						<div class="col-md-12">
							<button id="nextButton" class="time__btns_next">Далее</button>
							<button  class="time__btns_home">На главную</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<form id="serviceForm" action="{% url 'serviceFinally' %}" method="POST" enctype="multipart/form-data">

		{% csrf_token %}

		<input type="hidden" id="salonInput" name="selected_salon">
		<input type="hidden" id="serviceInput" name="selected_service">
		<input type="hidden" id="masterInput" name="selected_master">
		<input type="hidden" id="timeInput" name="selected_time">

	</form>

{% endblock %}

{% block script %}



<script>

	$(document).ready(function() {

		// menu

		$('.header__mobMenu').click(function() {
			$('#mobMenu').show()
		})

		$('.mobMenuClose').click(function() {
			$('#mobMenu').hide()
		})

		new AirDatepicker('#datepickerHere')

		var acc = document.getElementsByClassName("accordion");
		
		var i;

		for (i = 0; i < acc.length; i++) {
			acc[i].addEventListener("click", function(e) {
				e.preventDefault()
				this.classList.toggle("active");
				var panel = $(this).next()
				panel.hasClass('active') ?  
					 panel.removeClass('active')
					: 
					 panel.addClass('active')
		});
	}

	let salonName,serviceName,masterName,timeBlock;

	$(document).on('click', '.accordion__block', function(e) {
		let thisAddress;
		salonName = $(this).find('> .accordion__block_intro').text()
		thisAddress = $(this).find('> .accordion__block_address').text()
		$(this).parent().parent().find('> button.active').addClass('selected').text(salonName + '  ' +thisAddress)
		setTimeout(() => {
			$(this).parent().parent().find('> button.active').click()
		}, 200)

	})


	$('.accordion__block_item').click(function(e) {
		let thisAddress;
		serviceName = $(this).find('> .accordion__block_item_intro').text()
		thisAddress = $(this).find('> .accordion__block_item_address').text()
		$(this).parent().parent().parent().parent().find('> button.active').addClass('selected').text(serviceName + '  ' +thisAddress)
		setTimeout(() => {
			$(this).parent().parent().parent().parent().find('> button.active').click()
		}, 200)
	})

	$(document).on('click', '.service__masters .accordion__block', function(e) {
		// let clone = $(this).clone()
		masterName = $(this).find('> .accordion__block_master').text()
		let thisProf = $(this).find('> .accordion__block_prof').text()
		// console.log(clone)
		// $(this).parent().parent().find('> button.active').html(clone)
		$(this).parent().find('> button.active').addClass('selected').text(masterName + '  ' +thisProf)
		setTimeout(() => {
		$(this).parent().parent().find('> button.active').click()
		}, 200)
	})

	//service
	$('.time__items .time__elems_elem .time__elems_btn').click(function(e) {
		e.preventDefault()
		$('.time__elems_btn').removeClass('active')
		$(this).addClass('active')
		// $(this).hasClass('active') ? $(this).removeClass('active') : $(this).addClass('active')
	})

	$(document).on('click', '.servicePage', function() {
		if($('.time__items .time__elems_elem .time__elems_btn').hasClass('active') && $('.service__form_block > button').hasClass('selected')) {
			$('.time__btns_next').addClass('active')
		}
	})

	// Обработчик нажатия на кнопку "Далее"
	document.getElementById('nextButton').addEventListener('click', function() {
		// Записываем значения выбранных элементов в соответствующие <input> внутри <form>
		// document.getElementById('salonInput').value = salonName;
		// document.getElementById('serviceInput').value = serviceName;
		// document.getElementById('masterInput').value = masterName;
		// document.getElementById('timeInput').value = timeBlock;

		// Отправляем форму
		document.getElementById('serviceForm').submit();
	});

});
</script>

{% endblock %}
